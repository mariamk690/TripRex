@model CoreTripRex.Models.Dashboard.DashboardViewModel
@{
    ViewData["Title"] = "Plan Your Vacation";
}

<section class="py-5">
    <div class="container">
        <div class="row">

            <!-- LEFT COLUMN -->
            <div class="col-lg-9">

                <!-- Header -->
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h1 class="h3 mb-0">Plan your vacation</h1>

                    @if (Model.ShowResumeButton)
                    {
                        <a href="~/CurrentPackage" class="btn btn-outline-primary d-none d-md-inline">
                            Resume saved package
                        </a>
                    }
                </div>

                <!-- Messages -->
                @if (!string.IsNullOrWhiteSpace(Model.StatusMessage))
                {
                    <div class="text-muted small mb-3">@Html.Raw(Model.StatusMessage)</div>
                }

                @if (!string.IsNullOrWhiteSpace(Model.ErrorMessage))
                {
                    <div class="text-danger small mb-3">@Model.ErrorMessage</div>
                }

                <!-- ===========================
                     SEARCH FORM
                ============================ -->
                <form method="post" asp-action="Search">
                    <div class="card p-4 mb-4 shadow-sm">

                        <div class="row g-3">
                            <div class="col-md-3">
                                <label class="form-label">Current Location</label>
                                <input asp-for="Origin" class="form-control" placeholder="Philadelphia" />
                            </div>

                            <div class="col-md-3">
                                <label class="form-label">Destination</label>
                                <input asp-for="Destination" class="form-control" placeholder="Las Vegas" />
                            </div>

                            <div class="col-md-3">
                                <label class="form-label">Start Date</label>
                                <input asp-for="StartDate" type="date" class="form-control" />
                            </div>

                            <div class="col-md-3">
                                <label class="form-label">End Date</label>
                                <input asp-for="EndDate" type="date" class="form-control" />
                            </div>
                        </div>

                        <hr class="my-4" />

                        <!-- Include Section -->
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <label class="form-label d-block mb-2">Include in Package</label>

                                <div class="d-flex flex-wrap gap-4">

                                    <div class="form-check">
                                        <input asp-for="IncludeFlights" class="form-check-input" />
                                        <label class="form-check-label" asp-for="IncludeFlights">Flights</label>
                                    </div>

                                    <div class="form-check">
                                        <input asp-for="IncludeHotels" class="form-check-input" />
                                        <label class="form-check-label" asp-for="IncludeHotels">Hotels</label>
                                    </div>

                                    <div class="form-check">
                                        <input asp-for="IncludeCars" class="form-check-input" />
                                        <label class="form-check-label" asp-for="IncludeCars">Cars</label>
                                    </div>

                                    <div class="form-check">
                                        <input asp-for="IncludeEvents" class="form-check-input" />
                                        <label class="form-check-label" asp-for="IncludeEvents">Events</label>
                                    </div>

                                </div>
                            </div>

                            <div class="col-md-4 text-md-end mt-3 mt-md-0">
                                <button type="submit" class="btn btn-primary px-4">Find Options</button>
                            </div>
                        </div>

                    </div>
                </form>

                <!-- ===========================
                     FLIGHTS
                ============================ -->
                @if (Model.ShowFlights && Model.FlightVendors.Any())
                {
                    <div class="mb-5">
                        <h2 class="h5 mb-3">Roundtrip Flights</h2>

                        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">

                            @foreach (var vendor in Model.FlightVendors)
                            {
                                <div class="col">
                                    <div class="card shadow-sm h-100">

                                        <img src="@vendor.ImageUrl"
                                             class="card-img-top"
                                             style="height:140px; object-fit:contain; background-color:#f8f9fa;" />

                                        <div class="card-body d-flex flex-column justify-content-between">
                                            <div>
                                                <h5 class="card-title mb-1">@vendor.Vendor</h5>
                                                <p class="text-muted small mb-0">@vendor.Caption</p>
                                            </div>

                                            <div class="mt-auto d-flex justify-content-between align-items-center">
                                                <button class="btn btn-outline-primary btn-sm"
                                                        type="button"
                                                        data-bs-toggle="collapse"
                                                        data-bs-target="#flight_@vendor.Vendor.GetHashCode()">
                                                    View Flights
                                                </button>
                                                <span class="fw-semibold text-primary small">Economy & Business</span>
                                            </div>
                                        </div>

                                        <div id="flight_@vendor.Vendor.GetHashCode()" class="collapse border-top">
                                            <ul class="list-group list-group-flush">
                                                @foreach (var f in vendor.Options)
                                                {
                                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                                        <div>
                                                            <div class="fw-medium">Flight @f.FlightNumber</div>
                                                            <div class="text-muted small">@f.DepartCode → @f.ArriveCode</div>
                                                            <div class="text-muted small">@f.DepartTime:g → @f.ArriveTime:g</div>
                                                            <div class="text-muted small">Class: @f.ClassCode</div>
                                                        </div>

                                                        <div class="text-end">
                                                            <div class="fw-semibold text-primary mb-1">$@f.Price:F2</div>

                                                            <form method="post" asp-action="AddFlight">
                                                                <input type="hidden" name="flightId" value="@f.FlightID" />
                                                                <button type="submit" class="btn btn-success btn-sm">Add</button>
                                                            </form>
                                                        </div>
                                                    </li>
                                                }
                                            </ul>
                                        </div>

                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                }

                <!-- ===========================
                     HOTELS
                ============================ -->
                @if (Model.ShowHotels && Model.HotelVendors.Any())
                {
                    <div class="mb-5">
                        <h2 class="h5 mb-3">Hotels</h2>

                        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
                            @foreach (var h in Model.HotelVendors)
                            {
                                <div class="col">
                                    <div class="card shadow-sm h-100">

                                        <img src="@h.ImageUrl" class="card-img-top" style="height:160px; object-fit:cover;" />

                                        <div class="card-body d-flex flex-column">
                                            <div>
                                                <h5 class="card-title mb-1">@h.HotelName</h5>
                                                <p class="text-muted small mb-1">@h.Phone<br />@h.Email</p>
                                                <p class="text-muted small mb-0">@h.Caption</p>
                                            </div>

                                            <div class="mt-auto d-flex justify-content-between align-items-center">
                                                <button class="btn btn-outline-primary btn-sm"
                                                        type="button"
                                                        data-bs-toggle="collapse"
                                                        data-bs-target="#rooms_@h.VendorID">
                                                    View Rooms
                                                </button>

                                                <span class="fw-semibold text-primary">$@h.StartingPrice:F2/night</span>
                                            </div>
                                        </div>

                                        <div id="rooms_@h.VendorID" class="collapse border-top">
                                            <div class="card-body p-0">

                                                <div id="carousel_hotel_@h.VendorID" class="carousel slide" data-bs-ride="false">
                                                    <div class="carousel-inner">

                                                        @for (int i = 0; i < h.Rooms.Count; i++)
                                                        {
                                                            var r = h.Rooms[i];

                                                            <div class="carousel-item @(i == 0 ? "active" : "")">
                                                                <img src="@r.ImageUrl" class="card-img-top" style="height:160px; object-fit:cover;" />

                                                                <div class="card-body text-center">
                                                                    <p class="text-muted small mb-1">Max Guests: @r.MaxOccupancy</p>
                                                                    <p class="fw-semibold text-primary mb-2">$@r.PricePerNight:F2/night</p>

                                                                    <form method="post" asp-action="AddRoom">
                                                                        <input type="hidden" name="roomId" value="@r.ID" />
                                                                        <button type="submit" class="btn btn-success btn-sm w-100">Add</button>
                                                                    </form>
                                                                </div>
                                                            </div>
                                                        }

                                                    </div>

                                                    <button class="carousel-control-prev" type="button"
                                                            data-bs-target="#carousel_hotel_@h.VendorID" data-bs-slide="prev">
                                                        <span class="carousel-control-prev-icon"></span>
                                                    </button>
                                                    <button class="carousel-control-next" type="button"
                                                            data-bs-target="#carousel_hotel_@h.VendorID" data-bs-slide="next">
                                                        <span class="carousel-control-next-icon"></span>
                                                    </button>

                                                </div>

                                            </div>
                                        </div>

                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                }

                <!-- ===========================
                     CARS
                ============================ -->
                @if (Model.ShowCars && Model.CarVendors.Any())
                {
                    <div class="mb-5">
                        <h2 class="h5 mb-3">Car Rentals</h2>

                        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
                            @foreach (var c in Model.CarVendors)
                            {
                                <div class="col">
                                    <div class="card shadow-sm h-100">

                                        <img src="@c.ImageUrl" class="card-img-top" style="height:160px; object-fit:cover;" />

                                        <div class="card-body d-flex flex-column">
                                            <div>
                                                <h5 class="card-title mb-1">@c.Agency</h5>
                                                <p class="text-muted small mb-0">@c.Caption</p>
                                            </div>

                                            <div class="mt-auto d-flex justify-content-between align-items-center">
                                                <button class="btn btn-outline-primary btn-sm"
                                                        type="button"
                                                        data-bs-toggle="collapse"
                                                        data-bs-target="#cars_@c.VendorID">
                                                    View Cars
                                                </button>
                                                <span class="fw-semibold text-primary">from $@c.StartingPrice:F2/day</span>
                                            </div>
                                        </div>

                                        <div id="cars_@c.VendorID" class="collapse border-top">
                                            <div class="card-body p-0">

                                                <div id="carousel_car_@c.VendorID" class="carousel slide" data-bs-ride="false">

                                                    <div class="carousel-inner">
                                                        @for (int i = 0; i < c.Cars.Count; i++)
                                                        {
                                                            var car = c.Cars[i];

                                                            <div class="carousel-item @(i == 0 ? "active" : "")">
                                                                <img src="@car.ImageUrl" class="card-img-top" style="height:160px; object-fit:cover;" />

                                                                <div class="card-body text-center">
                                                                    <p class="text-muted small mb-1">
                                                                        @car.CarClass • Seats: @car.Seats
                                                                    </p>
                                                                    <p class="fw-semibold text-primary mb-2">$@car.DailyRate:F2/day</p>

                                                                    <form method="post" asp-action="AddCar">
                                                                        <input type="hidden" name="carId" value="@car.ID" />
                                                                        <button type="submit" class="btn btn-success btn-sm w-100">Add</button>
                                                                    </form>
                                                                </div>
                                                            </div>
                                                        }
                                                    </div>

                                                    <button class="carousel-control-prev" type="button"
                                                            data-bs-target="#carousel_car_@c.VendorID" data-bs-slide="prev">
                                                        <span class="carousel-control-prev-icon"></span>
                                                    </button>

                                                    <button class="carousel-control-next" type="button"
                                                            data-bs-target="#carousel_car_@c.VendorID" data-bs-slide="next">
                                                        <span class="carousel-control-next-icon"></span>
                                                    </button>

                                                </div>

                                            </div>
                                        </div>

                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                }

                <!-- ===========================
                     EVENTS
                ============================ -->
                @if (Model.ShowEvents && Model.EventVendors.Any())
                {
                    <div class="mb-5">
                        <h2 class="h5 mb-3">Events</h2>

                        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
                            @foreach (var e in Model.EventVendors)
                            {
                                <div class="col">
                                    <div class="card shadow-sm h-100">

                                        <img src="@e.ImageUrl" class="card-img-top" style="height:160px; object-fit:cover;" />

                                        <div class="card-body d-flex flex-column">
                                            <div>
                                                <h5 class="card-title mb-1">@e.Organizer</h5>
                                                <p class="text-muted small mb-1">Venue: @e.Venue</p>
                                                <p class="text-muted small mb-0">@e.Caption</p>
                                            </div>

                                            <div class="mt-auto">
                                                <button class="btn btn-outline-primary btn-sm"
                                                        type="button"
                                                        data-bs-toggle="collapse"
                                                        data-bs-target="#ev_@e.Organizer.GetHashCode()">
                                                    View Events
                                                </button>
                                            </div>
                                        </div>

                                        <div id="ev_@e.Organizer.GetHashCode()" class="collapse border-top">
                                            <ul class="list-group list-group-flush">
                                                @foreach (var ev in e.Events)
                                                {
                                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                                        <div>
                                                            <div class="fw-medium">@ev.Name</div>
                                                            <div class="text-muted small">@ev.StartTime:ddd, MMM d • h:mm tt</div>
                                                        </div>

                                                        <div class="text-end">
                                                            <div class="fw-semibold mb-2">
                                                                @(ev.Price == 0 ? "Free" : $"${ev.Price:F2}")
                                                            </div>

                                                            <form method="post" asp-action="AddEvent">
                                                                <input type="hidden" name="eventId" value="@ev.ID" />
                                                                <button type="submit" class="btn btn-success btn-sm">Add</button>
                                                            </form>
                                                        </div>
                                                    </li>
                                                }
                                            </ul>
                                        </div>

                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                }

            </div> <!-- END LEFT COL -->
            <!-- ===========================
                 RIGHT SIDEBAR — CART
            ============================ -->

            <div class="col-lg-3">
                @if (Model.ShowCart && Model.Cart != null && Model.Cart.Items.Any())
                {
                    <div class="card p-3 shadow-sm sticky-top" style="top: 90px;">

                        <h5 class="mb-3">Your Package</h5>

                        @foreach (var item in Model.Cart.Items)
                        {
                            <div class="border-bottom py-2">
                                <div class="d-flex justify-content-between">

                                    <div>
                                        <strong>@item.ServiceType</strong><br />
                                        <span class="fw-semibold">@item.DisplayName</span><br />
                                        <span class="text-muted small">@item.Details</span><br />
                                        <span class="text-muted small">Ref ID: @item.RefId</span>
                                    </div>

                                    <div class="text-end">
                                        <div class="fw-semibold text-primary">$@item.ItemPrice:F2</div>
                                        <div class="text-muted small">
                                            x @item.Quantity = $@item.ComputedPrice:F2
                                        </div>
                                    </div>

                                </div>
                            </div>
                        }

                        <div class="d-flex justify-content-between align-items-center mt-3">
                            <div class="fw-bold">Total: $@Model.Cart.Total:F2</div>

                            <div class="d-flex gap-2">
                                <a href="~/CurrentPackage" class="btn btn-primary btn-sm">View all</a>
                                <a href="~/Checkout" class="btn btn-primary btn-sm">Checkout</a>
                            </div>
                        </div>

                    </div>
                }
            </div>

        </div>
    </div>
</section>

